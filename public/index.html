<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Health Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Navbar -->
  <nav class="bg-indigo-600 p-4 text-white text-lg font-bold">
    Health Tracker Dashboard
  </nav>

  <!-- Dashboard Content -->
  <div class="flex-1 p-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

      <!-- Habits -->
      <div class="bg-white shadow rounded-xl p-4">
        <h2 class="text-xl font-semibold mb-2">Habits</h2>
        <form id="habitForm" class="flex gap-2 mb-2">
          <input type="text" id="habitInput" placeholder="Enter Habit" class="flex-1 border rounded p-2">
          <button class="bg-indigo-600 text-white px-4 py-2 rounded">Add</button>
        </form>
        <table class="w-full border">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">Habit</th>
              <th class="border p-1">Streak</th>
              <th class="border p-1">Today</th>
            </tr>
          </thead>
          <tbody id="habitHistory"></tbody>
        </table>
      </div>

      <!-- Workouts -->
      <div class="bg-white shadow rounded-xl p-4">
        <h2 class="text-xl font-semibold mb-2">Workouts</h2>
        <form id="workoutForm" class="flex gap-2 mb-2">
          <input type="text" id="workoutInput" placeholder="Enter Workout" class="flex-1 border rounded p-2">
          <button class="bg-indigo-600 text-white px-4 py-2 rounded">Add</button>
        </form>
        <canvas id="workoutChart"></canvas>
        <table class="w-full border mt-2">
          <thead class="bg-gray-100">
            <tr><th class="border p-1">Date</th><th class="border p-1">Exercise</th></tr>
          </thead>
          <tbody id="workoutHistory"></tbody>
        </table>
      </div>

      <!-- Meals -->
      <div class="bg-white shadow rounded-xl p-4">
        <h2 class="text-xl font-semibold mb-2">Meals</h2>
        <form id="mealForm" class="flex gap-2 mb-2">
          <input type="text" id="mealInput" placeholder="Enter Meal" class="flex-1 border rounded p-2">
          <button class="bg-indigo-600 text-white px-4 py-2 rounded">Add</button>
        </form>
        <canvas id="mealChart"></canvas>
        <table class="w-full border mt-2">
          <thead class="bg-gray-100">
            <tr><th class="border p-1">Date</th><th class="border p-1">Meal</th></tr>
          </thead>
          <tbody id="mealHistory"></tbody>
        </table>
      </div>

      <!-- Hydration -->
      <div class="bg-white shadow rounded-xl p-4">
        <h2 class="text-xl font-semibold mb-2">Hydration</h2>
        <form id="hydrationForm" class="flex gap-2 mb-2">
          <input type="number" id="hydrationInput" placeholder="Glasses" class="flex-1 border rounded p-2">
          <button class="bg-indigo-600 text-white px-4 py-2 rounded">Add</button>
        </form>
        <canvas id="hydrationChart"></canvas>
        <table class="w-full border mt-2">
          <thead class="bg-gray-100">
            <tr><th class="border p-1">Date</th><th class="border p-1">Glasses</th></tr>
          </thead>
          <tbody id="hydrationHistory"></tbody>
        </table>
      </div>

      <!-- Calories -->
      <div class="bg-white shadow rounded-xl p-4">
        <h2 class="text-xl font-semibold mb-2">Calories</h2>
        <form id="calorieForm" class="flex gap-2 mb-2">
          <input type="number" id="calorieInput" placeholder="Calories" class="flex-1 border rounded p-2">
          <button class="bg-indigo-600 text-white px-4 py-2 rounded">Add</button>
        </form>
        <canvas id="calorieChart"></canvas>
        <table class="w-full border mt-2">
          <thead class="bg-gray-100">
            <tr><th class="border p-1">Date</th><th class="border p-1">Calories</th></tr>
          </thead>
          <tbody id="calorieHistory"></tbody>
        </table>
      </div>

      <!-- Sleep -->
      <div class="bg-white shadow rounded-xl p-4">
        <h2 class="text-xl font-semibold mb-2">Sleep</h2>
        <form id="sleepForm" class="flex gap-2 mb-2">
          <input type="number" id="sleepInput" placeholder="Hours" class="flex-1 border rounded p-2">
          <button class="bg-indigo-600 text-white px-4 py-2 rounded">Add</button>
        </form>
        <table class="w-full border">
          <thead class="bg-gray-100">
            <tr><th class="border p-1">Date</th><th class="border p-1">Hours</th></tr>
          </thead>
          <tbody id="sleepHistory"></tbody>
        </table>
      </div>

    </div>
  </div>

<script>
const API_URL = "https://your-backend.onrender.com/api";
const userId = 1; // static for demo

// ===== Fetch Dashboard =====
async function loadDashboard(){
  const res = await fetch(`${API_URL}/dashboard/${userId}`);
  const data = await res.json();

  // Habits
  const habitHistory = document.getElementById("habitHistory");
  habitHistory.innerHTML = "";
  data.habits.forEach(h=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td class="border p-1">${h.habit_name}</td>
                    <td class="border p-1">${h.streak}</td>
                    <td class="border p-1">${h.completed_today ? "✅" : "❌"}</td>`;
    habitHistory.appendChild(tr);
  });

  // Workouts chart + history
  new Chart(document.getElementById("workoutChart"), {
    type:"bar",
    data:{ labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],
      datasets:[{ label:"Workouts", data:data.workouts, backgroundColor:"rgba(99,102,241,0.6)" }] }
  });
  const workoutHistory = document.getElementById("workoutHistory");
  workoutHistory.innerHTML="";
  data.workouts_history.forEach(w=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td class="border p-1">${w.day}</td><td class="border p-1">${w.exercise}</td>`;
    workoutHistory.appendChild(tr);
  });

  // Meals chart + history
  new Chart(document.getElementById("mealChart"), {
    type:"bar",
    data:{ labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],
      datasets:[{ label:"Meals", data:data.meals, backgroundColor:"rgba(16,185,129,0.6)" }] }
  });
  const mealHistory=document.getElementById("mealHistory");
  mealHistory.innerHTML="";
  data.meals_history.forEach(m=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td class="border p-1">${m.day}</td><td class="border p-1">${m.meal}</td>`;
    mealHistory.appendChild(tr);
  });

  // Hydration
  new Chart(document.getElementById("hydrationChart"), {
    type:"line",
    data:{ labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],
      datasets:[{ label:"Glasses", data:data.hydration, borderColor:"blue", fill:false }] }
  });
  const hydrationHistory=document.getElementById("hydrationHistory");
  hydrationHistory.innerHTML="";
  data.hydration_history.forEach(h=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td class="border p-1">${h.day}</td><td class="border p-1">${h.glasses}</td>`;
    hydrationHistory.appendChild(tr);
  });

  // Calories
  new Chart(document.getElementById("calorieChart"), {
    type:"line",
    data:{ labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],
      datasets:[{ label:"Calories", data:data.calories, borderColor:"red", fill:false }] }
  });
  const calorieHistory=document.getElementById("calorieHistory");
  calorieHistory.innerHTML="";
  data.calories_history.forEach(c=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td class="border p-1">${c.day}</td><td class="border p-1">${c.calories}</td>`;
    calorieHistory.appendChild(tr);
  });

  // Sleep
  const sleepHistory=document.getElementById("sleepHistory");
  sleepHistory.innerHTML="";
  data.sleep.forEach(s=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td class="border p-1">${s.date}</td><td class="border p-1">${s.hours}</td>`;
    sleepHistory.appendChild(tr);
  });
}

// ====== Form Handlers ======
document.getElementById("habitForm").onsubmit=async(e)=>{
  e.preventDefault();
  const habit=document.getElementById("habitInput").value;
  await fetch(`${API_URL}/habits/${userId}/add`,{
    method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({habit})
  });
  loadDashboard();
};

document.getElementById("workoutForm").onsubmit=async(e)=>{
  e.preventDefault();
  const exercise=document.getElementById("workoutInput").value;
  await fetch(`${API_URL}/workouts/${userId}/add`,{
    method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({exercise})
  });
  loadDashboard();
};

document.getElementById("mealForm").onsubmit=async(e)=>{
  e.preventDefault();
  const meal=document.getElementById("mealInput").value;
  await fetch(`${API_URL}/meals/${userId}/add`,{
    method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({meal})
  });
  loadDashboard();
};

document.getElementById("hydrationForm").onsubmit=async(e)=>{
  e.preventDefault();
  const glasses=document.getElementById("hydrationInput").value;
  await fetch(`${API_URL}/hydration/${userId}/add`,{
    method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({glasses})
  });
  loadDashboard();
};

document.getElementById("calorieForm").onsubmit=async(e)=>{
  e.preventDefault();
  const calories=document.getElementById("calorieInput").value;
  await fetch(`${API_URL}/calories/${userId}/add`,{
    method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({calories})
  });
  loadDashboard();
};

document.getElementById("sleepForm").onsubmit=async(e)=>{
  e.preventDefault();
  const hours=document.getElementById("sleepInput").value;
  await fetch(`${API_URL}/sleep/${userId}/add`,{
    method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({hours})
  });
  loadDashboard();
};

// Init
loadDashboard();
</script>
</body>
</html>
