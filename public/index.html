<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Health Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
html,body{margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(120deg,#a2d4f6 60%,#023e8a 100%);height:100vh;color:#fff;display:flex;justify-content:center;align-items:center;}
.container{width:95%;max-width:900px;position:relative;}
.card{background:rgba(255,255,255,0.14);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);padding:20px;border-radius:22px;text-align:center;display:none;}
.card.active{display:block;}
input,button{padding:10px;margin:5px;border-radius:7px;border:none;}
button{background:#023e8a;color:#fff;font-weight:bold;cursor:pointer;}
button:hover{background:#0077b6;}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.nav span{cursor:pointer;padding:5px 10px;background:rgba(255,255,255,0.12);margin-right:5px;border-radius:6px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #fff;padding:5px;text-align:center;}
</style>
</head>
<body>
<div class="container">

<div id="loginCard" class="card active">
<h2>Login</h2>
<form id="loginForm">
<input type="email" id="loginEmail" placeholder="Email" required><br>
<input type="password" id="loginPassword" placeholder="Password" required><br>
<button type="submit">Sign In</button>
</form>
<p>Don't have account? <span id="showSignup" style="cursor:pointer;color:#48cae4;">Sign Up</span></p>
</div>

<div id="signupCard" class="card">
<h2>Sign Up</h2>
<form id="signupForm">
<input type="email" id="signupEmail" placeholder="Email" required><br>
<input type="password" id="signupPassword" placeholder="Password" required><br>
<button type="submit">Sign Up</button>
</form>
<p>Already have account? <span id="showLogin" style="cursor:pointer;color:#48cae4;">Login</span></p>
</div>

<div id="dashboardCard" class="card">
<div class="topbar">
<div class="nav">
<span class="tab" data-tab="overview">Dashboard</span>
<span class="tab" data-tab="habits">Habits</span>
<span class="tab" data-tab="workouts">Workouts</span>
<span class="tab" data-tab="meals">Meals</span>
</div>
<div>
<span id="userInfo">Hi User</span> | <button id="logoutBtn">Logout</button>
</div>
</div>

<div id="tabContents">
<div id="overviewTab" class="tabContent">
<h3>Overview</h3>
<div id="overviewCards"></div>
<canvas id="caloriesChart"></canvas>
<canvas id="workoutsChart"></canvas>
<canvas id="mealsChart"></canvas>
<canvas id="hydrationChart"></canvas>
</div>
<div id="habitsTab" class="tabContent" style="display:none;"><h3>Habits</h3><table id="habitsTable"></table></div>
<div id="workoutsTab" class="tabContent" style="display:none;"><h3>Workouts</h3><table id="workoutsTable"></table></div>
<div id="mealsTab" class="tabContent" style="display:none;"><h3>Meals</h3><table id="mealsTable"></table></div>
</div>
</div>

</div>

<script>
const API_URL = "https://health-tracker-express.onrender.com";

const loginCard=document.getElementById("loginCard");
const signupCard=document.getElementById("signupCard");
const dashboardCard=document.getElementById("dashboardCard");

const showSignup=document.getElementById("showSignup");
const showLogin=document.getElementById("showLogin");
const loginForm=document.getElementById("loginForm");
const signupForm=document.getElementById("signupForm");
const logoutBtn=document.getElementById("logoutBtn");

const tabs=document.querySelectorAll(".tab");
const tabContents=document.querySelectorAll(".tabContent");

tabs.forEach(tab=>tab.addEventListener("click",()=>{tabContents.forEach(tc=>tc.style.display="none");document.getElementById(tab.dataset.tab+"Tab").style.display="block";}));

showSignup.addEventListener("click",()=>{loginCard.classList.remove("active");signupCard.classList.add("active");});
showLogin.addEventListener("click",()=>{signupCard.classList.remove("active");loginCard.classList.add("active");});

loginForm.addEventListener("submit",async e=>{
e.preventDefault();
const username=document.getElementById("loginEmail").value.trim();
const password=document.getElementById("loginPassword").value.trim();
const res=await fetch(`${API_URL}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password})});
const data=await res.json();
if(data.userId){localStorage.setItem("userId",data.userId);showDashboard();}
else alert(data.error||"Login failed");
});

signupForm.addEventListener("submit",async e=>{
e.preventDefault();
const username=document.getElementById("signupEmail").value.trim();
const password=document.getElementById("signupPassword").value.trim();
const res=await fetch(`${API_URL}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password})});
const data=await res.json();
if(data.message){alert("Signup success");signupCard.classList.remove("active");loginCard.classList.add("active");} 
else alert(data.error||"Signup failed");
});

logoutBtn.addEventListener("click",()=>{localStorage.removeItem("userId");dashboardCard.classList.remove("active");loginCard.classList.add("active");});

let caloriesChart,workoutsChart,mealsChart,hydrationChart;
const overviewCards=document.getElementById("overviewCards");

function populateTables(data){
const habitsTable=document.getElementById("habitsTable");
habitsTable.innerHTML="<tr><th>Habit</th><th>Streak</th></tr>";
data.habits.forEach(h=>{const tr=document.createElement("tr");tr.innerHTML=`<td>${h.habit_name}</td><td>${h.streak} days</td>`;habitsTable.appendChild(tr);});
const workoutsTable=document.getElementById("workoutsTable");
workoutsTable.innerHTML="<tr><th>Day</th><th>Sessions</th><th>Action</th></tr>";
data.labels.forEach((day,idx)=>{const tr=document.createElement("tr");tr.innerHTML=`<td>${day}</td><td>${data.workouts[idx]}</td><td><button onclick="addWorkout('${day}')">+1</button></td>`;workoutsTable.appendChild(tr);});
const mealsTable=document.getElementById("mealsTable");
mealsTable.innerHTML="<tr><th>Day</th><th>Meals</th><th>Action</th></tr>";
data.labels.forEach((day,idx)=>{const tr=document.createElement("tr");tr.innerHTML=`<td>${day}</td><td>${data.meals[idx]}</td><td><button onclick="addMeal('${day}')">+1</button></td>`;mealsTable.appendChild(tr);});
}

window.addWorkout=async(day)=>{const userId=localStorage.getItem("userId");await fetch(`${API_URL}/workouts/${userId}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({day,sessions:1})});showDashboard();}
window.addMeal=async(day)=>{const userId=localStorage.getItem("userId");await fetch(`${API_URL}/meals/${userId}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({day,meals:1})});showDashboard();}

async function showDashboard(){
loginCard.classList.remove("active");signupCard.classList.remove("active");dashboardCard.classList.add("active");
const userId=localStorage.getItem("userId");
document.getElementById("userInfo").innerText="User #"+userId;
const res=await fetch(`${API_URL}/dashboard/${userId}`);
const data=await res.json();
overviewCards.innerHTML=`
<div><strong>Habit Streak</strong><br>ðŸ”¥ ${data.habits[0]?.streak||0} days</div>
<div><strong>Workouts</strong><br>${data.workouts.reduce((a,b)=>a+b,0)} <button onclick="addWorkout('${data.labels[data.labels.length-1]}')">+1</button></div>
<div><strong>Meals</strong><br>${data.meals.reduce((a,b)=>a+b,0)} <button onclick="addMeal('${data.labels[data.labels.length-1]}')">+1</button></div>
<div><strong>Calories</strong><br>${data.calories[data.calories.length-1]} kcal</div>
<div><strong>Hydration</strong><br>${data.hydration[data.hydration.length-1]} glasses</div>
`;

if(caloriesChart) caloriesChart.destroy();if(workoutsChart) workoutsChart.destroy();if(mealsChart) mealsChart.destroy();if(hydrationChart) hydrationChart.destroy();
const labels=data.labels;
caloriesChart=new Chart(document.getElementById("caloriesChart"),{type:"line",data:{labels,datasets:[{label:"Calories",data:data.calories,borderColor:"#48cae4",fill:false}]}});
workoutsChart=new Chart(document.getElementById("workoutsChart"),{type:"bar",data:{labels,datasets:[{label:"Workouts",data:data.workouts,backgroundColor:"#0077b6"}]}});
mealsChart=new Chart(document.getElementById("mealsChart"),{type:"line",data:{labels,datasets:[{label:"Meals",data:data.meals,borderColor:"#90e0ef",fill:false}]}});
hydrationChart=new Chart(document.getElementById("hydrationChart"),{type:"bar",data:{labels,datasets:[{label:"Water",data:data.hydration,backgroundColor:"#023e8a"}]}});
}

if(localStorage.getItem("userId")) showDashboard();
</script>
</body>
</html>
