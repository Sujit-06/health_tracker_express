<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Health Tracker</title>
<style>
html,body{margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(120deg,#a2d4f6 60%,#023e8a 100%);height:100%;color:#fff;}
.container{width:95%;max-width:1000px;margin:20px auto;}
.card{background:rgba(255,255,255,0.1);backdrop-filter:blur(12px);padding:20px;border-radius:20px;margin-bottom:20px;display:none;}
.card.active{display:block;}
input,button{padding:10px;margin:5px;border-radius:8px;border:none;}
button{background:#023e8a;color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;}
button:hover{background:#0077b6;}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;}
.nav span{cursor:pointer;padding:8px 12px;background:rgba(255,255,255,0.12);margin-right:5px;border-radius:8px;transition:0.3s;}
.nav span:hover{background:rgba(255,255,255,0.2);}
.flex-row{display:flex;gap:15px;align-items:center;flex-wrap:wrap;justify-content:center;}
.overview-card{flex:1 1 180px;background:rgba(255,255,255,0.15);padding:15px;border-radius:15px;text-align:center;}
label{display:block;margin-top:10px;}
</style>
</head>
<body>
<div class="container">

<!-- LOGIN -->
<div id="loginCard" class="card active">
  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" required><br>
    <input type="password" id="loginPassword" placeholder="Password" required><br>
    <button type="submit">Sign In</button>
  </form>
  <p>Don't have account? <span id="showSignup" style="cursor:pointer;color:#48cae4;">Sign Up</span></p>
</div>

<!-- SIGNUP -->
<div id="signupCard" class="card">
  <h2>Sign Up</h2>
  <form id="signupForm">
    <input type="email" id="signupEmail" placeholder="Email" required><br>
    <input type="password" id="signupPassword" placeholder="Password" required><br>
    <button type="submit">Sign Up</button>
  </form>
  <p>Already have account? <span id="showLogin" style="cursor:pointer;color:#48cae4;">Login</span></p>
</div>

<!-- DASHBOARD -->
<div id="dashboardCard" class="card">
  <div class="topbar">
    <div class="nav">
      <span class="tab active" data-tab="overview">Dashboard</span>
      <span class="tab" data-tab="sleep">Sleep</span>
      <span class="tab" data-tab="study">Study</span>
      <span class="tab" data-tab="meals">Meals</span>
      <span class="tab" data-tab="hydration">Water</span>
    </div>
    <div>
      <span id="userInfo">Hi User</span> | <button id="logoutBtn">Logout</button>
    </div>
  </div>

  <div id="tabContents">

    <!-- OVERVIEW -->
    <div id="overviewTab" class="tabContent active">
      <h3>Today's Health Check</h3>
      <div id="overviewCards" class="flex-row"></div>
      <h3 id="healthMessage" style="text-align:center;margin-top:20px;"></h3>
    </div>

    <!-- SLEEP -->
    <div id="sleepTab" class="tabContent" style="display:none;">
      <h3>Sleep</h3>
      <label>Date</label>
      <input type="date" id="sleepDate">
      <label>Hours</label>
      <input type="number" id="sleepHours" placeholder="Hours">
      <button id="addSleepBtn">Save</button>
    </div>

    <!-- STUDY -->
    <div id="studyTab" class="tabContent" style="display:none;">
      <h3>Study</h3>
      <label>Date</label>
      <input type="date" id="studyDate">
      <label>Hours</label>
      <input type="number" id="studyHours" placeholder="Hours">
      <button id="addStudyBtn">Save</button>
    </div>

    <!-- MEALS -->
    <div id="mealsTab" class="tabContent" style="display:none;">
      <h3>Meals</h3>
      <label>Food</label><input type="text" id="foodInput" placeholder="Food">
      <button id="addMealBtn">Add Meal</button>
    </div>

    <!-- HYDRATION -->
    <div id="hydrationTab" class="tabContent" style="display:none;">
      <h3>Water Intake</h3>
      <label>Glasses</label>
      <input type="number" id="hydrationInput" placeholder="Glasses">
      <button id="addGlassBtn">Save</button>
    </div>

  </div>
</div>
</div>

<script>
const API_URL = "https://health-tracker-express.onrender.com";

const loginCard=document.getElementById("loginCard");
const signupCard=document.getElementById("signupCard");
const dashboardCard=document.getElementById("dashboardCard");
const showSignup=document.getElementById("showSignup");
const showLogin=document.getElementById("showLogin");
const loginForm=document.getElementById("loginForm");
const signupForm=document.getElementById("signupForm");
const logoutBtn=document.getElementById("logoutBtn");
const tabs=document.querySelectorAll(".tab");
const tabContents=document.querySelectorAll(".tabContent");

tabs.forEach(tab=>{
  tab.addEventListener("click",()=>{
    tabs.forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    tabContents.forEach(tc=>tc.style.display="none");
    document.getElementById(tab.dataset.tab+"Tab").style.display="block";
  });
});

showSignup.onclick=()=>{loginCard.classList.remove("active");signupCard.classList.add("active");}
showLogin.onclick=()=>{signupCard.classList.remove("active");loginCard.classList.add("active");}

loginForm.onsubmit=async e=>{
  e.preventDefault();
  const username=document.getElementById("loginEmail").value;
  const password=document.getElementById("loginPassword").value;
  const res=await fetch(`${API_URL}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password})});
  const data=await res.json();
  if(data.userId){localStorage.setItem("userId",data.userId);showDashboard();}
  else alert("Login failed");
};

signupForm.onsubmit=async e=>{
  e.preventDefault();
  const username=document.getElementById("signupEmail").value;
  const password=document.getElementById("signupPassword").value;
  const res=await fetch(`${API_URL}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password})});
  const data=await res.json();
  if(data.message){alert("Signup success");showLogin.click();}
  else alert("Signup failed");
};

logoutBtn.onclick=()=>{localStorage.removeItem("userId");dashboardCard.classList.remove("active");loginCard.classList.add("active");}

async function showDashboard(){
  loginCard.classList.remove("active");
  signupCard.classList.remove("active");
  dashboardCard.classList.add("active");
  const userId=localStorage.getItem("userId");
  document.getElementById("userInfo").innerText="User #"+userId;

  const res=await fetch(`${API_URL}/dashboard/${userId}`);
  const data=await res.json();

  const overviewCards=document.getElementById("overviewCards");
  overviewCards.innerHTML="";
  const cards=[
    {title:"Water", value:`${data.water} glasses`},
    {title:"Sleep", value:`${data.sleep} hrs`},
    {title:"Study", value:`${data.study} hrs`},
    {title:"Meals", value:`${data.meals} times`}
  ];
  cards.forEach(c=>{
    const div=document.createElement("div");
    div.className="overview-card";
    div.innerHTML=`<strong>${c.title}</strong><br>${c.value}`;
    overviewCards.appendChild(div);
  });

  let healthGood=(data.water>=8 && data.sleep>=7 && data.study>=4 && data.meals>=3);
  document.getElementById("healthMessage").innerText=healthGood?"✅ Your health is good":"❌ Needs improvement";
}

if(localStorage.getItem("userId")) showDashboard();

// --- actions ---
document.getElementById("addSleepBtn").onclick=async()=>{
  const date=document.getElementById("sleepDate").value;
  const hours=document.getElementById("sleepHours").value;
  if(!date||!hours) return;
  const userId=localStorage.getItem("userId");
  await fetch(`${API_URL}/sleep/${userId}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date,hours})});
  showDashboard();
};

document.getElementById("addStudyBtn").onclick=async()=>{
  const date=document.getElementById("studyDate").value;
  const hours=document.getElementById("studyHours").value;
  if(!date||!hours) return;
  const userId=localStorage.getItem("userId");
  await fetch(`${API_URL}/study/${userId}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date,hours})});
  showDashboard();
};

document.getElementById("addMealBtn").onclick=async()=>{
  const food=document.getElementById("foodInput").value;
  if(!food) return;
  const userId=localStorage.getItem("userId");
  await fetch(`${API_URL}/meals/${userId}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({food,quantity:1})});
  showDashboard();
};

document.getElementById("addGlassBtn").onclick=async()=>{
  const glasses=document.getElementById("hydrationInput").value;
  if(!glasses) return;
  const userId=localStorage.getItem("userId");
  await fetch(`${API_URL}/hydration/${userId}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glasses})});
  showDashboard();
};
</script>
</body>
</html>
